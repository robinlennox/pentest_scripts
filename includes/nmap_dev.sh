#!/bin/bash

# Nmap Dependencies
PACKAGE_NAME="Nmap"
PRINT_MESSAGE "Checking for ${PACKAGE_NAME} updates"
for DEPENDPKG in autoconf build-essential libssl-dev liblinear-dev libpcap0.8-dev libpcre3-dev binutils-dev liblua5.2-dev
do
	dpkg -s ${DEPENDPKG} 2>&1 | grep -o Installed-Size
	if [ $? != 0 ] ; then
		PRINT_GOOD "Install ${PACKAGE_NAME} Dependency - ${DEPENDPKG}"
		sudo apt-get -y install ${DEPENDPKG}
	fi
done

# NMap SVN #
#Local Variables
SVNLOCATION="https://svn.nmap.org/nmap"
REMOTEVERSION=$(svn info ${SVNLOCATION} | grep Revision | cut -f 2 -d:)
LOCALVERSION=$(svn info "${TOOLSDIRECTORY}"/nmap/ | grep Revision | cut -f 2 -d:)
EXIST=$(which nmap | grep nmap)
#NMap Install Function
nmap_install()
{
		PRINT_GOOD "Downloading ${PACKAGE_NAME}"
		svn co ${SVNLOCATION}
		cd ./nmap/
		./configure
		make
		sudo make install clean
}
cd "${TOOLSDIRECTORY}"
if [ ! -d ./nmap/ ]; then
	nmap_install
elif [ "$EXIST" = "" ]; then
	PRINT_ERROR "${PACKAGE_NAME} not installed. This needs to be redownloaded and complied"
	rm -rf ./nmap/
	nmap_install
elif [ "${LOCALVERSION}" -lt "${REMOTEVERSION}" ]; then #If Revision numbers
	PRINT_ERROR "Running old Nmap"
	cd "${TOOLSDIRECTORY}"/nmap
	PRINT_GOOD "Uninstalling old ${PACKAGE_NAME}"
	sudo make uninstall
	svn up
	nmap_install
	PRINT_GOOD "${PACKAGE_NAME} updated"
else
	PRINT_GOOD "${PACKAGE_NAME} already up-to-date"
fi