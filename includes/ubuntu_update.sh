#!/bin/bash

# Import Function
source nice_print.sh

# Script prerequisites
for DEPENDPKG in build-essential curl git make subversion
do
	dpkg -s ${DEPENDPKG} 2>&1 | grep -o Installed-Size
	if [ $? != 0 ] ; then
		PRINT_GOOD "Install Script Dependency - ${DEPENDPKG}"
		sudo apt-get -y install ${DEPENDPKG}
	fi
done

# Update Ubuntu
PRINT_MESSAGE "Checking for Ubuntu updates"

#Don't accept changes to configuration file
echo N | sudo dpkg --configure -a

#Distro Upgrade
sudo apt-get dist-upgrade -y
sudo apt-get autoclean -y
sudo apt-get autoremove -y

UPDATE_CHECK=$(sudo apt-get update)
if [ -z "$UPDATE_CHECK" ] ; then
	PRINT_ERROR "Update file is Locked, removing lock"
	# Kill Process
	sudo killall -9 apt-get
	# Remove Common Lock Files
	sudo rm /var/lib/dpkg/lock
	sudo rm /var/lib/apt/lists/lock
	sudo rm /var/cache/apt/archives/lock
	#Rerun update
	sudo apt-get update
fi

UPGRADE_INSTALLED=$(sudo apt-get -y --force-yes upgrade | cut -d ' ' -f1-5 | grep -Eo '[1-9]')
if [ -z "$UPGRADE_INSTALLED" ] ; then
	PRINT_GOOD "Ubuntu already up-to-date"
else
	PRINT_GOOD "Ubuntu updated"
fi