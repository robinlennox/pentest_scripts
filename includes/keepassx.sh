#!/bin/bash

# KeepassX
PACKAGE_NAME="KeepassX"
PRINT_MESSAGE "Checking for ${PACKAGE_NAME} updates"
# KeepassX Dependencies
for DEPENDPKG in cmake libgcrypt11-dev qt-sdk build-essential
do
	dpkg -s ${DEPENDPKG} 2>&1 | grep -o Installed-Size
	if [ $? != 0 ] ; then
		PRINT_GOOD "Install ${PACKAGE_NAME} Dependency - ${DEPENDPKG}"
		sudo apt-get -y install ${DEPENDPKG}
	fi
done

keypassx_install()
{
	check_status=$( ps aux | grep keepassx | grep -v grep | awk '{print $11}' )
	
	# If Closed
	if [ -z ${check_status} ]; then
		PRINT_GOOD "Install ${PACKAGE_NAME}"
		cd "${TOOLSDIRECTORY}/keepassx/"
		mkdir build
		cd build
		cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
		make 2>&1 | tee make.log
		sudo make install 2>&1 | tee make-install.log
	else
		PRINT_ERROR "${PACKAGE_NAME} open, update skipped."
	fi
}

cd "${TOOLSDIRECTORY}"
if [ ! -d ./keepassx/ ]; then
	PRINT_GOOD "Downloading ${PACKAGE_NAME}"
	git clone https://github.com/keepassx/keepassx.git keepassx
	keypassx_install
else
	cd ./keepassx/
	git pull | grep -o "Already up-to-date"
	if [ $? = 0 ] ; then
		PRINT_GOOD "${PACKAGE_NAME} already up-to-date"
	else
		keypassx_install
		PRINT_GOOD "${PACKAGE_NAME} updated"
	fi
fi